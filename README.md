# Blog_Microservice
基于Spring Boot框架的web项目（单体式应用），将其改造为微服务架构的系统。改造为BlogWeb应用和内部服务集群两个部分，内部服务集群中含有文章微服务，栏目微服务，统计微服务，用户微服务，API网关（负载均衡），授权服务器和注册中心

一.原系统的功能介绍
文章管理：通过对本人文章的状态进行显示，分别有已发表，草稿箱，回收站3种状态，全部文章即为他们的总和。博客管理是超级管理员的权限，具有所有作者文章的管理。用户包括管理员都可以以他们的权限进行文章的管理，有文章的保存为草稿箱，发表，编辑，放入回收站，永久删除，批量删除等操作。

用户管理：只有当超级管理员登录时才有的权限，可以对不同的用户进行权限设置。
 
栏目管理：具有栏目的添加，修改和删除的功能。
 
数据统计：每天进行一次数据统计，对于当前用户的浏览量进行统计，然后用数据可视化显示。
 
二. 新系统中所有组件的功能介绍
1.文章微服务（e-article）提供服务：
（1）.通过不同状态获取属于各自的文章以及文章数目
（2）.获取当前用户的全部文章
（3）.当是超级管理员时，获取全部文章数据
（4）.通过文章uid与当前用户获取该文章数据
（5）.通过文章uid与当前用户编辑该文章
（6）.通过文章uid与当前用户删除该文章
（7）.通过文章uid与当前用户放入回收站
（8）.通过文章uid与当前用户保存至草稿箱
（9）.获取传来的文章数据并且保存下来，也就是发表功能
2.栏目微服务（e-category）提供服务：
（1）.	获取全部栏目信息
（2）.	通过栏目cid获取该栏目信息
（3）.	通过栏目cid编辑该栏目信息
（4）.	通过栏目cid删除该栏目信息
（5）.	通过栏目cid获取该栏目名字
3.统计微服务（e-tongji）提供服务：
（1）.	通过当前用uid获取统计pv数据
（2）.	统计pv统计数据更新：通过当前用户uid以及统计微服务使用Feign调用文章微服务获取当前用户所有的文章列表，然后遍历该文章列表统计浏览数pageview得到sumPageView，最后获取当前日期进行数据库的插入更新（INSERT INTO pv(countDate,pv,uid) VALUES(NOW(),#{sumPageView},
#{uid})）。
4.blogWeb应用（ysd-blog）负责展示：
调用文章数据微服务，栏目数据微服务和统计数据微服务的API，并处理API调用可能出现的异常。
5.API网关（e-zuul-auth）：
（1）注册中心一直运行；
（2）微服务实例启动后就注册到注册中心，下线后注册中心会删除该实例的注册条目；
（3）API网关实例启动后也注册到注册中心；
（4）外部系统调用微服务时，它先在注册中心查询API网关服务实例，再发调用请求给API网关，API网关根据调用请求的路径查询路由配置得到服务名，再在注册中心根据服务名查询要调用服务的实例，再负载均衡地调用该实例，调用完后把响应返回给外部系统。
6.授权服务器（e-auth）：
客户端（即blogWeb应用调用端）以自己的名义到授权服务器获取访问令牌，直接对客户端进行身份验证，验证通过后，返回 token。 
获取资源： 获取到访问令牌（access_token）之后就可以使用访问令牌到资源服务器获取用户资源
7.注册中心（e-server）：
（1）注册
文章，栏目和统计微服务实例启动后都把自己的微服务名与ip地址和端口号发给注册中心存储（即注册）；
注册中心一直监听所有已注册微服务实例的心跳，若一段时间监听不到某个微服务实例的心跳，注册中心就认为该实例终止了，就从服务注册表中删掉该条注册数据，这样服务注册表中保存的都是可用实例的注册数据；
（2）发现
客户端（即blogWeb应用调用端）要调用某个微服务时，就向注册中心发查询该服务名对应的地址的请求，注册中心返回该服务名对应的多个实例的地址列表；
（3）调用
客户端按编码时确定的负载均衡策略调用实例列表中的一个微服务实例。

